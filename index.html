<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UniMatch AI Chatbot</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<style>
/* (Same CSS as before, copy your previous CSS) */
* { box-sizing: border-box; margin:0; padding:0; }
body { font-family: 'Inter', sans-serif; background: #f0f0f0; display:flex; justify-content:center; align-items:center; height:100vh; padding:10px;}
#main-container { display:flex; width:100%; max-width:900px; height:90vh; border-radius:20px; overflow:hidden; box-shadow:0 10px 40px rgba(0,0,0,0.3);}
#sidebar { width:30%; background:#2575fc; color:#fff; display:flex; flex-direction:column; padding:15px; overflow-y:auto; }
#sidebar h2 { font-weight:600; margin-bottom:10px; font-size:18px; }
#new-chat-btn { background:#fff; color:#2575fc; border:none; padding:8px 12px; margin-bottom:10px; border-radius:12px; cursor:pointer; font-weight:600; transition:0.2s; }
#new-chat-btn:hover { background:#e0e0e0; }
.chat-item { background: rgba(255,255,255,0.2); padding: 10px 12px; margin-bottom:10px; border-radius:12px; cursor:pointer; position: relative; transition:0.2s; }
.chat-item:hover { background: rgba(255,255,255,0.35); }
.chat-item .more-btn { position:absolute; right:10px; top:50%; transform:translateY(-50%); display:none; background:transparent; border:none; font-weight:bold; font-size:18px; cursor:pointer; color:#fff;}
.chat-item:hover .more-btn { display:block; }
#chat-container { flex:1; display:flex; flex-direction:column; background: rgba(255,255,255,0.95); border-radius:20px; }
#chat { flex:1; padding:20px; overflow-y:auto; display:flex; flex-direction:column; gap:14px; min-height:0; }
.message { padding:12px 20px; border-radius:25px; max-width:75%; font-size:15px; line-height:1.4; word-wrap:break-word; opacity:0; transform:translateY(20px); animation:fadeIn 0.3s forwards; box-shadow:0 2px 10px rgba(0,0,0,0.1);}
.user { align-self:flex-end; background:#2575fc; color:#fff; border-bottom-right-radius:0; }
.bot { align-self:flex-start; background:#e0e0e0; color:#333; border-bottom-left-radius:0; }
@keyframes fadeIn { to { opacity:1; transform:translateY(0);} }
#input-container { display:flex; padding:15px; border-top:1px solid #ccc; background:#fafafa; align-items:center; }
#user-input { flex:1; padding:14px 18px; border:none; outline:none; border-radius:50px; margin-right:12px; background:#f0f0f0; }
#user-input:focus { background:#e2e2e2; }
#send-btn { background:#2575fc; color:#fff; border:none; padding:12px 20px; border-radius:50px; cursor:pointer; transition:0.2s; }
#send-btn:hover { background:#6a11cb; }
.typing { display:inline-block; width:60px; text-align:left; }
.typing span { display:inline-block;width:8px;height:8px;margin-right:4px;background:#ccc;border-radius:50%;animation:blink 1.4s infinite both;}
.typing span:nth-child(2){animation-delay:0.2s;} 
.typing span:nth-child(3){animation-delay:0.4s;}
@keyframes blink {0%,80%,100%{opacity:0;}40%{opacity:1;}}
</style>
</head>
<body>

<div id="main-container">
  <div id="sidebar">
    <h2>Chats</h2>
    <button id="new-chat-btn">+ New Chat</button>
    <div id="chat-list"></div>
  </div>
  <div id="chat-container">
    <div id="chat"></div>
    <div id="input-container">
      <input type="text" id="user-input" placeholder="Enter your interests, marks, and city..." />
      <button id="send-btn">Send</button>
    </div>
  </div>
</div>

<script>
// Storage & elements
const chat = document.getElementById("chat");
const input = document.getElementById("user-input");
const sendBtn = document.getElementById("send-btn");
const chatList = document.getElementById("chat-list");
const newChatBtn = document.getElementById("new-chat-btn");
let chats = JSON.parse(localStorage.getItem("chats") || "[]");
let currentChatIndex = chats.length ? chats.length - 1 : 0;

// City â†’ Universities mapping
const cityUnis = {
  "wah cantt": ["PIEAS", "COMSATS Wah", "HITEC University"],
  "islamabad": ["NUST", "COMSATS", "FAST"],
  "lahore": ["UET Lahore", "LUMS", "UCP"],
  "karachi": ["NED", "IBA", "SZABIST"]
};

// Bot reply logic
function generateBotReply(userMessage) {
  userMessage = userMessage.toLowerCase();

  // Interests
  if (userMessage.includes("computer") || userMessage.includes("cs")) {
    return "ðŸ’» Based on your interest in computers, consider Software Engineering or AI. Top universities: NUST, LUMS, FAST.";
  }

  // Marks
  if (userMessage.includes("marks") && userMessage.match(/\d+/)) {
    const marks = parseInt(userMessage.match(/\d+/)[0]);
    if (marks >= 85) return "ðŸŽ“ Excellent marks! Aim for top universities like NUST or LUMS.";
    if (marks >= 70) return "ðŸ“˜ Good marks! Consider FAST, PIEAS, or UET Lahore.";
    return "ðŸ“š Explore universities with moderate entry requirements like Bahria University or COMSATS.";
  }

  // City-based
  for (const city in cityUnis) {
    if (userMessage.includes(city)) {
      return `ðŸ« In ${city.charAt(0).toUpperCase() + city.slice(1)}, you can consider: ${cityUnis[city].join(", ")}.`;
    }
  }

  // Generic city query
  if (userMessage.includes("city") || userMessage.includes("uni")) {
    return "ðŸŒ† Tell me your city, and I can suggest nearby universities.";
  }

  return "ðŸ¤” Thanks! Based on your interests and marks, explore relevant fields in Pakistan.";
}

// Sidebar
function renderSidebar() {
  chatList.innerHTML = "";
  chats.slice().reverse().forEach((session, reverseIdx) => {
    const idx = chats.length - 1 - reverseIdx;
    if (!session.length) return;
    const lastMsg = session[session.length - 1].message || "New Chat";
    const chatItem = document.createElement("div");
    chatItem.classList.add("chat-item");
    chatItem.textContent = lastMsg.slice(0,30) + "...";
    const moreBtn = document.createElement("button");
    moreBtn.classList.add("more-btn");
    moreBtn.textContent = "âœ–";
    moreBtn.addEventListener("click", e => {
      e.stopPropagation();
      if (confirm("Delete this chat?")) {
        chats.splice(idx,1); saveChats();
        if (currentChatIndex===idx) chat.innerHTML="";
      }
    });
    chatItem.appendChild(moreBtn);
    chatItem.dataset.index = idx;
    chatItem.addEventListener("click", ()=>{currentChatIndex=idx; loadChat(idx);});
    chatList.appendChild(chatItem);
  });
}

function loadChat(index) {
  chat.innerHTML = "";
  chats[index].forEach(msg=>appendMessage(msg.message,msg.type));
}

function saveChats(){localStorage.setItem("chats",JSON.stringify(chats)); renderSidebar();}

function appendMessage(message,type){
  const msgDiv = document.createElement("div");
  msgDiv.classList.add("message",type);
  msgDiv.textContent = message;
  chat.appendChild(msgDiv);
  chat.scrollTop = chat.scrollHeight;
}

function showTyping(){
  const typingDiv = document.createElement("div");
  typingDiv.classList.add("message","bot");
  typingDiv.innerHTML='<div class="typing"><span></span><span></span><span></span></div>';
  chat.appendChild(typingDiv);
  chat.scrollTop = chat.scrollHeight;
  return typingDiv;
}

// Send message
async function sendMessage(){
  const userMessage = input.value.trim();
  if(!userMessage) return;
  if(!chats[currentChatIndex]) chats[currentChatIndex]=[];
  chats[currentChatIndex].push({message:userMessage,type:"user"});
  appendMessage(userMessage,"user");
  input.value="";
  saveChats();
  const typingDiv = showTyping();
  setTimeout(()=>{
    const botReply = generateBotReply(userMessage);
    typingDiv.remove();
    appendMessage(botReply,"bot");
    chats[currentChatIndex].push({message:botReply,type:"bot"});
    saveChats();
  },800);
}

sendBtn.addEventListener("click",sendMessage);
input.addEventListener("keypress",e=>{if(e.key==="Enter") sendMessage();});
newChatBtn.addEventListener("click",()=>{
  chats.push([]);
  currentChatIndex = chats.length-1;
  chat.innerHTML="";
  appendMessage("ðŸ‘‹ Hello! I am UniMatch AI. Tell me your interests, marks, and city, and I will suggest the best fields and universities for you.","bot");
  saveChats();
});

// Initial load
if(!chats.length){
  chats.push([]);
  currentChatIndex=0;
  appendMessage("ðŸ‘‹ Hello! I am UniMatch AI. Tell me your interests, marks, and city, and I will suggest the best fields and universities for you.","bot");
  saveChats();
}else{
  renderSidebar();
  loadChat(currentChatIndex);
}
</script>

</body>
</html>
